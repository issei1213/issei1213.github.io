<!doctype html><html lang=ja-jp>
<head><title>
TypeScript Tip #1 |
TechBlog</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name=description content="背景 前回のmattさんのTypeScript Tip #15が勉強になったので、最初から#1からまとめていく
概要 export const fruitCounts = { apple: 1, pear: 4, banana: 26 } 上記の様なコードがあった時に、特定のキーを取得する型エイリアスで定義すると以下になる。
type SingleFruitCount = | { apple: number } | { banana: number } | { pear: number } const singleFruitCount: SingleFruitCount = { apple: 10, } SingleFruitCountの型エイリアスを作成すれば、型定義できるが定数fruitCountsを型推論させて型エイリアスを作成する。
本題 最終的なコードは以下になる。具体的に解説していく。
type FruitCounts = typeof fruitCounts type NewSingleFruitCount = { [ K in keyof FruitCounts ]: { [ K2 in K ]: number } }[keyof FruitCounts] // type NewSingleFruitCount = { // apple: number; // } | { // pear: number; // } | { // banana: number; // }  typeof fruitCountsは型推論が効いて以下の型が作成される。  type FruitCounts = { apple: number; pear: number; banana: number; } [ K in keyof FruitCounts ]のkeyof FruitCountsは型エイリアスのオブジェクトのキーのみを取得することができる。
    ">
<meta property="og:image" content="https://issei1213.github.ioimg/logo.png">
<meta name=twitter:card content="summary">
<meta property="og:title" content="TypeScript Tip #1">
<meta property="og:description" content="背景 前回のmattさんのTypeScript Tip #15が勉強になったので、最初から#1からまとめていく
概要 export const fruitCounts = { apple: 1, pear: 4, banana: 26 } 上記の様なコードがあった時に、特定のキーを取得する型エイリアスで定義すると以下になる。
type SingleFruitCount = | { apple: number } | { banana: number } | { pear: number } const singleFruitCount: SingleFruitCount = { apple: 10, } SingleFruitCountの型エイリアスを作成すれば、型定義できるが定数fruitCountsを型推論させて型エイリアスを作成する。
本題 最終的なコードは以下になる。具体的に解説していく。
type FruitCounts = typeof fruitCounts type NewSingleFruitCount = { [ K in keyof FruitCounts ]: { [ K2 in K ]: number } }[keyof FruitCounts] // type NewSingleFruitCount = { // apple: number; // } | { // pear: number; // } | { // banana: number; // }  typeof fruitCountsは型推論が効いて以下の型が作成される。  type FruitCounts = { apple: number; pear: number; banana: number; } [ K in keyof FruitCounts ]のkeyof FruitCountsは型エイリアスのオブジェクトのキーのみを取得することができる。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://issei1213.github.io/posts/typescript_tip-1/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-04-07T12:43:39+09:00">
<meta property="article:modified_time" content="2022-04-07T12:43:39+09:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="TypeScript Tip #1">
<meta name=twitter:description content="背景 前回のmattさんのTypeScript Tip #15が勉強になったので、最初から#1からまとめていく
概要 export const fruitCounts = { apple: 1, pear: 4, banana: 26 } 上記の様なコードがあった時に、特定のキーを取得する型エイリアスで定義すると以下になる。
type SingleFruitCount = | { apple: number } | { banana: number } | { pear: number } const singleFruitCount: SingleFruitCount = { apple: 10, } SingleFruitCountの型エイリアスを作成すれば、型定義できるが定数fruitCountsを型推論させて型エイリアスを作成する。
本題 最終的なコードは以下になる。具体的に解説していく。
type FruitCounts = typeof fruitCounts type NewSingleFruitCount = { [ K in keyof FruitCounts ]: { [ K2 in K ]: number } }[keyof FruitCounts] // type NewSingleFruitCount = { // apple: number; // } | { // pear: number; // } | { // banana: number; // }  typeof fruitCountsは型推論が効いて以下の型が作成される。  type FruitCounts = { apple: number; pear: number; banana: number; } [ K in keyof FruitCounts ]のkeyof FruitCountsは型エイリアスのオブジェクトのキーのみを取得することができる。">
<meta itemprop=name content="TypeScript Tip #1">
<meta itemprop=description content="背景 前回のmattさんのTypeScript Tip #15が勉強になったので、最初から#1からまとめていく
概要 export const fruitCounts = { apple: 1, pear: 4, banana: 26 } 上記の様なコードがあった時に、特定のキーを取得する型エイリアスで定義すると以下になる。
type SingleFruitCount = | { apple: number } | { banana: number } | { pear: number } const singleFruitCount: SingleFruitCount = { apple: 10, } SingleFruitCountの型エイリアスを作成すれば、型定義できるが定数fruitCountsを型推論させて型エイリアスを作成する。
本題 最終的なコードは以下になる。具体的に解説していく。
type FruitCounts = typeof fruitCounts type NewSingleFruitCount = { [ K in keyof FruitCounts ]: { [ K2 in K ]: number } }[keyof FruitCounts] // type NewSingleFruitCount = { // apple: number; // } | { // pear: number; // } | { // banana: number; // }  typeof fruitCountsは型推論が効いて以下の型が作成される。  type FruitCounts = { apple: number; pear: number; banana: number; } [ K in keyof FruitCounts ]のkeyof FruitCountsは型エイリアスのオブジェクトのキーのみを取得することができる。"><meta itemprop=datePublished content="2022-04-07T12:43:39+09:00">
<meta itemprop=dateModified content="2022-04-07T12:43:39+09:00">
<meta itemprop=wordCount content="247">
<meta itemprop=keywords content="TypeScript,">
<link rel=canonical href=https://issei1213.github.io/posts/typescript_tip-1/>
<link rel=icon type=image/png href=https://issei1213.github.ioimg/favicon.png>
<link rel=stylesheet href=/css/font-awesome.min.css>
<link rel=stylesheet href=/css/bulma.min.css>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-3WPQ6FJXBQ','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<script src=/js/ramium.js></script>
<link rel=stylesheet href=/css/ramium.css>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3WPQ6FJXBQ"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config',"G-3WPQ6FJXBQ")</script>
</head>
<body><nav class="navbar is-dark" role=navigation aria-label="main navigation">
<div class=navbar-brand>
<a class=navbar-item href=/>
<strong>TechBlog </strong>
</a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=navbarBasicExample>
<span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span>
</a>
</div>
<div id=navbarBasicExample class=navbar-menu>
<div class=navbar-start>
<a class=navbar-item href=/>ホーム</a>
<div class="navbar-item has-dropdown is-hoverable">
<a class=navbar-link>ブログ</a>
<div class=navbar-dropdown>
<a class=navbar-item href=/tags/>タグ</a>
<a class=navbar-item href=/posts/>記事</a>
</div>
</div>
</div>
<div class=navbar-end>
<a class="navbar-item navgithub" href=https://github.com/issei1213 target=_blank>
<i class="fa fa-github fa-2x"></i>
</a>
<a class="navbar-item navgithub" href=https://twitter.com/abIOELEsEfu6Os0 target=_blank>
<i class="fa brands fa-twitter fa-2x"></i>
</a>
</div>
</div>
</nav><div class="columns is-centered">
<div id=page-body class="column is-7">
<div class="content blog">
<h1>TypeScript Tip #1</h1>
<div id=infobar class="level is-mobile">
<div class=level-left>
<div class=level-item>
<p class="subtitle info date">Apr 7, 2022
</p>
</div>
<div class=level-item>
<p class="subtitle info">
6 mins read
</p>
</div>
</div>
<div class="level-right is-hidden-touch">
<div class=tags>
<a class="tag is-dark is-rounded" href=/tags/typescript>TypeScript</a>
</div>
</div>
</div>
<div class="tags is-hidden-desktop">
<a class="tag is-dark is-rounded" href=/tags/typescript>Type script</a>
</div>
<div class=blog-text>
<h2 id=背景>背景</h2>
<p>前回のmattさんのTypeScript Tip #15が勉強になったので、最初から#1からまとめていく</p>
<h2 id=概要>概要</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fruitCounts</span> <span style=color:#f92672>=</span> {
    <span style=color:#a6e22e>apple</span>: <span style=color:#66d9ef>1</span>,
    <span style=color:#a6e22e>pear</span>: <span style=color:#66d9ef>4</span>,
    <span style=color:#a6e22e>banana</span>: <span style=color:#66d9ef>26</span>
}
</code></pre></div><p>上記の様なコードがあった時に、特定のキーを取得する型エイリアスで定義すると以下になる。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SingleFruitCount</span> <span style=color:#f92672>=</span> 
    <span style=color:#f92672>|</span> {
        <span style=color:#a6e22e>apple</span>: <span style=color:#66d9ef>number</span>    
    }
    <span style=color:#f92672>|</span> {
        <span style=color:#a6e22e>banana</span>: <span style=color:#66d9ef>number</span>
    }
    <span style=color:#f92672>|</span> {
        <span style=color:#a6e22e>pear</span>: <span style=color:#66d9ef>number</span>
    }

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>singleFruitCount</span>: <span style=color:#66d9ef>SingleFruitCount</span> <span style=color:#f92672>=</span> {
    <span style=color:#a6e22e>apple</span>: <span style=color:#66d9ef>10</span>,
}
</code></pre></div><p><code>SingleFruitCount</code>の型エイリアスを作成すれば、型定義できるが定数<code>fruitCounts</code>を型推論させて型エイリアスを作成する。</p>
<h2 id=本題>本題</h2>
<p>最終的なコードは以下になる。具体的に解説していく。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FruitCounts</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>fruitCounts</span>

<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>NewSingleFruitCount</span> <span style=color:#f92672>=</span> {
    [ <span style=color:#a6e22e>K</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>FruitCounts</span> ]<span style=color:#f92672>:</span> { 
        [ <span style=color:#a6e22e>K2</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>K</span> ]<span style=color:#f92672>:</span> <span style=color:#66d9ef>number</span>
    }
}[<span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>FruitCounts</span>]

<span style=color:#75715e>//  type NewSingleFruitCount = {
</span><span style=color:#75715e>//      apple: number;
</span><span style=color:#75715e>//    } | {
</span><span style=color:#75715e>//      pear: number;
</span><span style=color:#75715e>//    } | {
</span><span style=color:#75715e>//      banana: number;
</span><span style=color:#75715e>//  }
</span></code></pre></div><ol>
<li><code>typeof fruitCounts</code>は型推論が効いて以下の型が作成される。</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FruitCounts</span> <span style=color:#f92672>=</span> {
    <span style=color:#a6e22e>apple</span>: <span style=color:#66d9ef>number</span>;
    <span style=color:#a6e22e>pear</span>: <span style=color:#66d9ef>number</span>;
    <span style=color:#a6e22e>banana</span>: <span style=color:#66d9ef>number</span>;
}
</code></pre></div><ol start=2>
<li><code>[ K in keyof FruitCounts ]</code>の<code>keyof FruitCounts</code>は型エイリアスのオブジェクトのキーのみを取得することができる。<br>
よって、<code>keyof FruitCounts</code>は<code>"apple" | "pear" | "banana"</code>変換される。<br>
そうすると、<code>[ K in keyof FruitCounts ]</code>は<code>[ K in "apple" | "pear" | "banana" ]</code>に変換し、<strong>マップ型</strong>で型を繰り返し実装される。<br>
参考Notion: <a href=https://stitch-squid-866.notion.site/Map-652db5e51b8e465ab9fc79a8596c16af target=_blank>Map型</a></li>
<li><code>[K2 in K]: number</code>で<code>K</code>は単独のリテラル型(<code> "apple" | "pear" | "banana</code>)になる。なので、<code>K2</code>も<code>K</code>と同じリテラル型になる。</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>NewSingleFruitCount</span> <span style=color:#f92672>=</span> {
    <span style=color:#a6e22e>apple</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>apple</span>: <span style=color:#66d9ef>number</span>;
    };
    <span style=color:#a6e22e>pear</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>pear</span>: <span style=color:#66d9ef>number</span>;
    };
    <span style=color:#a6e22e>banana</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>banana</span>: <span style=color:#66d9ef>number</span>;
    };
}
</code></pre></div><p>なぜ新たに<code>[K2 in K]</code>マップ型を作成しているかというと、もし<code>K: number</code>で実装した場合、</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>NewSingleFruitCount</span> <span style=color:#f92672>=</span> {
    <span style=color:#a6e22e>apple</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>K</span>: <span style=color:#66d9ef>number</span>;
    };
    <span style=color:#a6e22e>pear</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>K</span>: <span style=color:#66d9ef>number</span>;
    };
    <span style=color:#a6e22e>banana</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>K</span>: <span style=color:#66d9ef>number</span>;
    };
}
</code></pre></div><p><code>K</code>のリテラル型になり、マップした変数<code>K</code>が使用できなくなる。オブジェクトのキーで変数を使用したい場合は、インデックスシグネチャを使用するしかなくなる。</p>
<ol start=4>
<li><code>[keyof FruitCounts]</code>は<code>["apple" | "pear" | "banana"]</code>になり、ルックアップ型でキーを指定して取得することできる。ルックアップ型がユニオン型になっているため、取得した型もユニオン型で生成することができる。<br>
これまでのコードを型推論したコードを記載すると</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>NewSingleFruitCount</span> <span style=color:#f92672>=</span> {
    <span style=color:#a6e22e>apple</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>apple</span>: <span style=color:#66d9ef>number</span>;
    }
    <span style=color:#a6e22e>pear</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>pear</span>: <span style=color:#66d9ef>number</span>;
    }
    <span style=color:#a6e22e>banana</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>banana</span>: <span style=color:#66d9ef>number</span>;
    }
}[<span style=color:#e6db74>&#34;apple&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;pear&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;banana&#34;</span>]
</code></pre></div><p>になり、以下のコードになる</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>NewSingleFruitCount</span> <span style=color:#f92672>=</span> {
    <span style=color:#a6e22e>apple</span>: <span style=color:#66d9ef>number</span>;
} <span style=color:#f92672>|</span> {
    <span style=color:#a6e22e>pear</span>: <span style=color:#66d9ef>number</span>;
} <span style=color:#f92672>|</span> {
    <span style=color:#a6e22e>banana</span>: <span style=color:#66d9ef>number</span>;
}
</code></pre></div><h2 id=まとめ>まとめ</h2>
<p>TypeScriptにはユーティリティ型が充実しているため、マップ型やルックアップ型を使うことが少ないが、いつでも使える状態にしておきたい。</p>
<h2 id=参考文献>参考文献</h2>
<p><a href=https://twitter.com/mpocock1/status/1497262298368409605 target=_blank>TypeScript tip</a><br>
<a href=https://stitch-squid-866.notion.site/Map-652db5e51b8e465ab9fc79a8596c16af target=_blank>Map型</a></p>
</div>
</div><div id=social-media-share class=has-text-centered>
<br>
<div class=share-buttons>
</div>
</div>
<br>
<div id=disqus_thread></div>
<script type=text/javascript>(function(){var a,b;if(window.location.hostname=="localhost")return;a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
</div>
</div>
<footer class="footer has-background-dark">
<div class="content has-text-centered has-text-white">
<p>© 2022 issei1213 All rights reserved.</p>
</div>
</footer>
</body>
</html>